Ocata version looks like this:

root@osa:~# docker ps
CONTAINER ID        IMAGE                                                 COMMAND             CREATED             STATUS              PORTS               NAMES
541fcdfe1c1d        kolla/centos-binary-horizon:4.0.0                     "kolla_start"       6 months ago        Up 6 minutes                            horizon
d5e056a34968        kolla/centos-binary-heat-engine:4.0.0                 "kolla_start"       6 months ago        Up 6 minutes                            heat_engine
8833d61e0873        kolla/centos-binary-heat-api-cfn:4.0.0                "kolla_start"       6 months ago        Up 6 minutes                            heat_api_cfn
aed9da6601b5        kolla/centos-binary-heat-api:4.0.0                    "kolla_start"       6 months ago        Up 6 minutes                            heat_api
f85b7aac7597        kolla/centos-binary-neutron-metadata-agent:4.0.0      "kolla_start"       6 months ago        Up 6 minutes                            neutron_metadata_agent
b21ea8839a67        kolla/centos-binary-neutron-l3-agent:4.0.0            "kolla_start"       6 months ago        Up 6 minutes                            neutron_l3_agent
13b67d701d0c        kolla/centos-binary-neutron-dhcp-agent:4.0.0          "kolla_start"       6 months ago        Up 6 minutes                            neutron_dhcp_agent
92452b6a66be        kolla/centos-binary-neutron-openvswitch-agent:4.0.0   "kolla_start"       6 months ago        Up 6 minutes                            neutron_openvswitch_agent
40e8ed916391        kolla/centos-binary-neutron-server:4.0.0              "kolla_start"       6 months ago        Up 6 minutes                            neutron_server
c27dcdfa48b9        kolla/centos-binary-openvswitch-vswitchd:4.0.0        "kolla_start"       6 months ago        Up 6 minutes                            openvswitch_vswitchd
747a5703da42        kolla/centos-binary-openvswitch-db-server:4.0.0       "kolla_start"       6 months ago        Up 6 minutes                            openvswitch_db
66747984b5eb        kolla/centos-binary-nova-compute:4.0.0                "kolla_start"       6 months ago        Up 5 minutes                            nova_compute
e12b61bccc55        kolla/centos-binary-nova-novncproxy:4.0.0             "kolla_start"       6 months ago        Up 6 minutes                            nova_novncproxy
e01a402a452d        kolla/centos-binary-nova-consoleauth:4.0.0            "kolla_start"       6 months ago        Up 6 minutes                            nova_consoleauth
3cd2dd3f7d67        kolla/centos-binary-nova-conductor:4.0.0              "kolla_start"       6 months ago        Up 6 minutes                            nova_conductor
735355d27fcd        kolla/centos-binary-nova-scheduler:4.0.0              "kolla_start"       6 months ago        Up 6 minutes                            nova_scheduler
58be193911f7        kolla/centos-binary-nova-api:4.0.0                    "kolla_start"       6 months ago        Up 6 minutes                            nova_api
d89bedf1d84f        kolla/centos-binary-nova-placement-api:4.0.0          "kolla_start"       6 months ago        Up 6 minutes                            placement_api
fa7fbd4a97cd        kolla/centos-binary-nova-libvirt:4.0.0                "kolla_start"       6 months ago        Up 6 minutes                            nova_libvirt
a04d447737e0        kolla/centos-binary-nova-ssh:4.0.0                    "kolla_start"       6 months ago        Up 6 minutes                            nova_ssh
0de67aa40087        kolla/centos-binary-glance-registry:4.0.0             "kolla_start"       6 months ago        Up 6 minutes                            glance_registry
55a63464be40        kolla/centos-binary-glance-api:4.0.0                  "kolla_start"       6 months ago        Up 6 minutes                            glance_api
4733b5150137        kolla/centos-binary-keystone:4.0.0                    "kolla_start"       6 months ago        Up 6 minutes                            keystone
d00528425061        kolla/centos-binary-rabbitmq:4.0.0                    "kolla_start"       6 months ago        Up 6 minutes                            rabbitmq
7513180bbfc1        kolla/centos-binary-mariadb:4.0.0                     "kolla_start"       6 months ago        Up 6 minutes                            mariadb
dee65dd81375        kolla/centos-binary-memcached:4.0.0                   "kolla_start"       6 months ago        Up 6 minutes                            memcached
d14fedfdca7c        kolla/centos-binary-keepalived:4.0.0                  "kolla_start"       6 months ago        Up 6 minutes                            keepalived
90550271ecd2        kolla/centos-binary-haproxy:4.0.0                     "kolla_start"       6 months ago        Up 6 minutes                            haproxy
16eac64e322a        kolla/centos-binary-cron:4.0.0                        "kolla_start"       6 months ago        Up 6 minutes                            cron
60cfbc64b780        kolla/centos-binary-kolla-toolbox:4.0.0               "kolla_start"       6 months ago        Up 6 minutes                            kolla_toolbox
26ff99a6ad8b        kolla/centos-binary-fluentd:4.0.0                     "kolla_start"       6 months ago        Up 6 minutes                            fluentd

Reading over:

https://docs.openstack.org/kolla-ansible/latest/user/operating-kolla.html

we need to update the file:

root@osa:~# grep openstack_release /etc/kolla/globals.yml
openstack_release: "4.0.0"


Let's update the kolla-ansible tool:

root@osa:~# pip install -U kolla-ansible


$ first error:

root@osa:~# kolla-ansible upgrade
Upgrading OpenStack Environment : ansible-playbook -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one -e @/etc/kolla/globals.yml -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e action=upgrade -e serial=0 /usr/local/share/kolla-ansible/ansible/site.yml
ERROR! Unexpected Exception: 'module' object has no attribute 'SSL_ST_INIT'

fixed by updating the pyOpenSSL module:

https://github.com/andresriancho/w3af/issues/15260

root@osa:~# pip uninstall pyOpenSSL
Uninstalling pyOpenSSL-0.15.1:
  /usr/lib/python2.7/dist-packages/OpenSSL
  /usr/lib/python2.7/dist-packages/pyOpenSSL-0.15.1.egg-info
Proceed (y/n)? y
  Successfully uninstalled pyOpenSSL-0.15.1
root@osa:~# pip install pyOpenSSL
Collecting pyOpenSSL
  Downloading pyOpenSSL-17.5.0-py2.py3-none-any.whl (53kB)
    100% |████████████████████████████████| 61kB 914kB/s

### Second error:

RUNNING HANDLER [common : Restart fluentd container] ***************************
fatal: [localhost]: FAILED! => {"changed": true, "failed": true, "msg": "'Traceback (most recent call last):\\n  File \"/tmp/ansible_EwrJnL/ansible_module_kolla_docker.py\", line 799, in main\\n    result = bool(getattr(dw, module.params.get(\\'action\\'))())\\n  File \"/tmp/ansible_EwrJnL/ansible_module_kolla_docker.py\", line 597, in recreate_or_restart_container\\n    self.start_container()\\n  File \"/tmp/ansible_EwrJnL/ansible_module_kolla_docker.py\", line 603, in start_container\\n    self.pull_image()\\n  File \"/tmp/ansible_EwrJnL/ansible_module_kolla_docker.py\", line 456, in pull_image\\n    repository=image, tag=tag, stream=True\\n  File \"/usr/local/lib/python2.7/dist-packages/docker/api/image.py\", line 381, in pull\\n    header = auth.get_config_header(self, registry)\\nAttributeError: \\'module\\' object has no attribute \\'get_config_header\\'\\n'"}

RUNNING HANDLER [common : Restart kolla-toolbox container] *********************

RUNNING HANDLER [common : Restart cron container] ******************************
	to retry, use: --limit @/usr/local/share/kolla-ansible/ansible/site.retry

PLAY RECAP *********************************************************************
localhost                  : ok=12   changed=7    unreachable=0    failed=1

had to update docker python module and remove the pydocker module:

https://github.com/docker/docker-py/issues/1353

root@osa:~# pip uninstall docker docker-py
Uninstalling docker-2.7.0:
Uninstalling docker-py-1.10.6:

# then just installing docker module:

root@osa:~# pip install docker
Collecting docker
  Using cached docker-2.7.0-py2.py3-none-any.whl

Here were all the versions I had:

root@osa:~# docker --version
Docker version 17.05.0-ce, build 89658be
root@osa:~# pip --version
pip 9.0.1 from /usr/local/lib/python2.7/dist-packages (python 2.7)
root@osa:~# pip show docker
Name: docker
Version: 2.7.0
Summary: A Python library for the Docker Engine API.
root@osa:~# ansible --version
ansible 2.3.1.0
  config file =
  configured module search path = Default w/o overrides
  python version = 2.7.12 (default, Nov 20 2017, 18:23:56) [GCC 5.4.0 20160609]
  root@osa:~# pip show kolla-ansible
  Name: kolla-ansible
  Version: 5.0.1
  Summary: Ansible Deployment of Kolla containers


## Third Error
Then ran into this:

raise cls(e, response=response, explanation=explanation)\\nNotFound: 404 Client Error: Not Found (\"manifest for kolla/centos-binary-fluentd:5.0.0 not found\")\\n'"}

I tried to pull new images:

root@osa:~# kolla-ansible pull -i  /usr/local/share/kolla-ansible/ansible/inventory/all-in-one

But ran into a similar issue:

create_api_error_from_http_exception\\n    raise cls(e, response=response, explanation=explanation)\\nNotFound: 404 Client Error: Not Found (\"manifest for kolla/centos-binary-kolla-toolbox:5.0.0 not found\")\\n'"}

based on this post it looks like the images don't yet exist:

https://ask.openstack.org/en/question/110691/kolla-images-for-pike-with-tag-500-dont-exist-on-docker-hub-registry/

So next I decided to build the  images which requires the **tox** tool:

https://docs.openstack.org/kolla/latest/admin/image-building.html


Actually ended up doing this:

https://ask.openstack.org/en/question/93967/kolla-build-command-not-found/

  root@osa:~# git clone https://github.com/openstack/kolla.git
  Cloning into 'kolla'...
  remote: Counting objects: 58018, done.
  remote: Compressing objects: 100% (37/37), done.
  remote: Total 58018 (delta 14), reused 15 (delta 8), pack-reused 57973
  Receiving objects: 100% (58018/58018), 9.12 MiB | 12.91 MiB/s, done.
  Resolving deltas: 100% (35133/35133), done.
  Checking connectivity... done.
  root@osa:~# cd kolla/
  root@osa:~/kolla# git branch -r
    origin/HEAD -> origin/master
    origin/master
    origin/stable/ocata
    origin/stable/pike
  root@osa:~/kolla# git checkout stable/pike
  Branch stable/pike set up to track remote branch stable/pike from origin.
  Switched to a new branch 'stable/pike'
  root@osa:~/kolla# ls
  bindep.txt  contrib  deliverables.yaml  doc  docker  etc  HACKING.rst  kolla  LICENSE  README.rst  releasenotes  requirements.txt  setup.cfg  setup.py  specs  test-requirements.txt  tests  tools  tox.ini
  root@osa:~/kolla# cd kolla/
  root@osa:~/kolla/kolla# ls
  cmd  common  exception.py  hacking  image  __init__.py  opts.py  template  tests  version.py
  root@osa:~/kolla/kolla# cd ..
  root@osa:~/kolla# ls
  bindep.txt  contrib  deliverables.yaml  doc  docker  etc  HACKING.rst  kolla  LICENSE  README.rst  releasenotes  requirements.txt  setup.cfg  setup.py  specs  test-requirements.txt  tests  tools  tox.ini
  root@osa:~/kolla# tox -e genconfig
  genconfig create: /root/kolla/.tox/genconfig
  genconfig installdeps: -r/root/kolla/requirements.txt, -r/root/kolla/test-requirements.txt
  genconfig develop-inst: /root/kolla
  genconfig installed: alabaster==0.7.10,appdirs==1.4.3,asn1crypto==0.22.0,Babel==2.3.4,backports.ssl-match-hostname==3.5.0.1,bandit==1.4.0,bashate==0.5.1,beautifulsoup4==4.6.0,certifi==2017.4.17,cffi==1.10.0,chardet==3.0.4,cliff==2.8.0,cmd2==0.7.5,coverage==4.4.1,cryptography==2.0.2,ddt==1.1.1,debtcollector==1.17.1,deprecation==1.0.1,doc8==0.8.0,docker==2.4.2,docker-pycreds==0.2.1,docutils==0.13.1,dulwich==0.17.3,enum34==1.1.6,extras==1.0.0,fixtures==3.0.0,flake8==2.5.5,funcsigs==1.0.2,functools32==3.2.3.post2,futures==3.1.1,gitdb==0.6.4,gitdb2==2.0.2,GitPython==2.1.5,graphviz==0.8,hacking==0.12.0,idna==2.5,imagesize==0.7.1,ipaddress==1.0.18,iso8601==0.1.11,Jinja2==2.9.6,jsonpatch==1.16,jsonpointer==1.10,jsonschema==2.6.0,keystoneauth1==3.1.0,-e git+https://github.com/openstack/kolla.git@5bae59ba945d20b1a75b086379d1f40f08b44196#egg=kolla,linecache2==1.0.0,MarkupSafe==1.0,mccabe==0.2.1,mock==2.0.0,monotonic==1.3,mox3==0.23.0,msgpack-python==0.4.8,netaddr==0.7.19,netifaces==0.10.6,openstackdocstheme==1.16.1,openstacksdk==0.9.17,os-client-config==1.28.0,osc-lib==1.7.0,oslo.config==4.11.1,oslo.context==2.17.1,oslo.i18n==3.17.1,oslo.log==3.30.1,oslo.serialization==2.20.1,oslo.utils==3.28.1,oslotest==2.17.1,pbr==3.1.1,pep8==1.5.7,pkg-resources==0.0.0,positional==1.1.2,prettytable==0.7.2,pycparser==2.18,pyflakes==0.8.1,Pygments==2.2.0,pyinotify==0.9.6,pyOpenSSL==17.2.0,pyparsing==2.2.0,pyperclip==1.5.27,python-barbicanclient==4.5.2,python-ceilometerclient==2.9.0,python-cinderclient==3.1.0,python-dateutil==2.6.1,python-glanceclient==2.8.0,python-heatclient==1.11.1,python-keystoneclient==3.13.0,python-mimeparse==1.6.0,python-neutronclient==6.5.0,python-novaclient==9.1.1,python-openstackclient==3.12.0,python-subunit==1.2.0,python-swiftclient==3.4.0,pytz==2017.2,PyYAML==3.12,reno==2.5.0,requests==2.18.2,requestsexceptions==1.3.0,restructuredtext-lint==1.1.1,rfc3986==1.1.0,simplejson==3.11.1,six==1.10.0,smmap==0.9.0,smmap2==2.0.3,snowballstemmer==1.2.1,Sphinx==1.6.3,sphinxcontrib-websupport==1.0.1,stevedore==1.25.1,testrepository==0.0.20,testscenarios==0.5.0,testtools==2.3.0,traceback2==1.4.0,typing==3.6.1,unicodecsv==0.14.1,unittest2==1.1.0,urllib3==1.22,warlock==1.2.0,websocket-client==0.44.0,wrapt==1.10.10
  genconfig runtests: PYTHONHASHSEED='2131518256'
  genconfig runtests: commands[0] | oslo-config-generator --config-file etc/oslo-config-generator/kolla-build.conf
  /root/kolla/.tox/genconfig/local/lib/python2.7/site-packages/oslo_config/types.py:54: UserWarning: converting '[]' to a string
    warnings.warn('converting \'%s\' to a string' % str_val)
  ________________________________________________________________________________________________________________ summary ________________________________________________________________________________________________________________
    genconfig: commands succeeded
    congratulations :)

Then I was able to to build the images:

root@osa:~/kolla# .tox/genconfig/bin/kolla-build -b centos
NFO:kolla.image.build:Found the docker image folder at /root/kolla/docker
INFO:kolla.image.build:Added image base to queue
INFO:kolla.image.build:Attempt number: 1 to run task: BuildTask(base)
INFO:kolla.image.build.base:Building
INFO:kolla.image.build.base:Step 1/31 : FROM centos:7
INFO:kolla.image.build.base: ---> 3fa822599e10
INFO:kolla.image.build.base:Step 2/31 : LABEL maintainer "Kolla Project (https://launchpad.net/kolla)" name "base" build-date "20171230"
INFO:kolla.image.build.base: ---> Running in c14b31ede1fb
INFO:kolla.image.build.base: ---> e11b0fa371df
..
...
INFO:kolla.image.build.mariadb:Successfully tagged kolla/centos-binary-mariadb:5.0.1
INFO:kolla.image.build.mariadb:Built
INFO:kolla.image.build:=========================
INFO:kolla.image.build:Successfully built images
INFO:kolla.image.build:=========================
INFO:kolla.image.build:aodh-api
INFO:kolla.image.build:aodh-base
INFO:kolla.image.build:aodh-evaluator
INFO:kolla.image.build:aodh-expirer
INFO:kolla.image.build:aodh-listener
INFO:kolla.image.build:aodh-notifier
INFO:kolla.image.build:barbican-api
INFO:kolla.image.build:barbican-base
...
...
INFO:kolla.image.build:tacker-server
INFO:kolla.image.build:telegraf
INFO:kolla.image.build:tempest
INFO:kolla.image.build:tgtd
INFO:kolla.image.build:trove-api
INFO:kolla.image.build:trove-base
INFO:kolla.image.build:trove-conductor
INFO:kolla.image.build:trove-guestagent
INFO:kolla.image.build:trove-taskmanager
INFO:kolla.image.build:watcher-api
INFO:kolla.image.build:watcher-applier
INFO:kolla.image.build:watcher-base
INFO:kolla.image.build:watcher-engine
INFO:kolla.image.build:zaqar
INFO:kolla.image.build:zookeeper

When I tried to do an update it failed to start up the new rabbitmq service:

TASK [rabbitmq : Find gospel node] ******************************************************************************************************************************************************************************************************
fatal: [localhost]: FAILED! => {"changed": true, "cmd": ["docker", "exec", "-t", "rabbitmq", "/usr/local/bin/rabbitmq_get_gospel_node"], "delta": "0:00:02.014192", "end": "2017-12-30 12:34:01.379612", "failed": true, "failed_when_result": true, "rc": 0, "start": "2017-12-30 12:33:59.365420", "stderr": "", "stderr_lines": [], "stdout": "{\"failed\": true, \"changed\": true, \"error\": \"Traceback (most recent call last):\\n  File \\\"/usr/local/bin/rabbitmq_get_gospel_node\\\", line 29, in main\\n    shell=True, stderr=subprocess.STDOUT  # nosec: this command appears\\n  File \\\"/usr/lib64/python2.7/subprocess.py\\\", line 575, in check_output\\n    raise CalledProcessError(retcode, cmd, output=output)\\nCalledProcessError: Command '/usr/sbin/rabbitmqctl eval 'rabbit_clusterer:status().'' returned non-zero exit status 2\\n\"}", "stdout_lines": ["{\"failed\": true, \"changed\": true, \"error\": \"Traceback (most recent call last):\\n  File \\\"/usr/local/bin/rabbitmq_get_gospel_node\\\", line 29, in main\\n    shell=True, stderr=subprocess.STDOUT  # nosec: this command appears\\n  File \\\"/usr/lib64/python2.7/subprocess.py\\\", line 575, in check_output\\n    raise CalledProcessError(retcode, cmd, output=output)\\nCalledProcessError: Command '/usr/sbin/rabbitmqctl eval 'rabbit_clusterer:status().'' returned non-zero exit status 2\\n\"}"]}

NO MORE HOSTS LEFT **********************************************************************************************************************************************************************************************************************
	to retry, use: --limit @/usr/local/share/kolla-ansible/ansible/site.retry

PLAY RECAP ******************************************************************************************************************************************************************************************************************************
localhost                  : ok=67   changed=15   unreachable=0    failed=1

I wasn't sure why that happened so I decided to just do a brand new deployment of 5.0.1. Since that looked like the latest:

https://docs.openstack.org/releasenotes/kolla/pike.html

So I destroyed the original deployment:

root@osa:~# kolla-ansible destroy -i all-in-one --yes-i-really-really-mean-it
Destroy Kolla containers, volumes and host configuration : ansible-playbook -i all-in-one -e @/etc/kolla/globals.yml -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  /usr/local/share/kolla-ansible/ansible/destroy.yml

PLAY [Apply role destroy] ***************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ******************************************************************************************************************************************************************************************************************
ok: [localhost]

TASK [destroy : Creating /kolla-cleanup/tools directory on node] ************************************************************************************************************************************************************************
changed: [localhost]

TASK [destroy : Copying validate-docker-execute.sh file] ********************************************************************************************************************************************************************************
changed: [localhost]

TASK [destroy : Copying cleanup-containers file] ****************************************************************************************************************************************************************************************
changed: [localhost]

TASK [destroy : Copying cleanup-host file] **********************************************************************************************************************************************************************************************
changed: [localhost]

TASK [destroy : Copying cleanup-images file] ********************************************************************************************************************************************************************************************
skipping: [localhost]

TASK [destroy : Destroying all Kolla containers and volumes] ****************************************************************************************************************************************************************************
changed: [localhost]

TASK [destroy : Removing Kolla images] **************************************************************************************************************************************************************************************************
skipping: [localhost]

TASK [destroy : Destroying Kolla host configuration] ************************************************************************************************************************************************************************************
changed: [localhost]

TASK [destroy : Destroying kolla-cleanup folder] ****************************************************************************************************************************************************************************************
changed: [localhost]

PLAY RECAP ******************************************************************************************************************************************************************************************************************************
localhost                  : ok=8    changed=7    unreachable=0    failed=0

Then trying to re-deploy, I saw the following error:

root@osa:~# kolla-ansible prechecks -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one
Pre-deployment checking : ansible-playbook -i all-in-one -e @/etc/kolla/globals.yml -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e action=precheck /usr/local/share/kolla-ansible/ansible/site.yml
 [WARNING]: Found variable using reserved name: action
..
..
TASK [octavia : include] ****************************************************************************************************************************************************************************************************************
skipping: [localhost]

PLAY [Apply role zun] *******************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY [Apply role skydive] ***************************************************************************************************************************************************************************************************************
skipping: no hosts matched

PLAY RECAP ******************************************************************************************************************************************************************************************************************************
localhost                  : ok=45   changed=0    unreachable=0    failed=0

and then the deploy:
root@osa:~# kolla-ansible deploy -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one
Deploying Playbooks : ansible-playbook -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one -e @/etc/kolla/globals.yml -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e action=deploy /usr/local/share/kolla-ansible/ansible/site.yml
 [WARNING]: Found variable using reserved name: action


PLAY [Gather facts for all hosts] *******************************************************************************************************************************************************************************************************

TASK [setup] ****************************************************************************************************************************************************************************************************************************
ok: [localhost]
..
..
TASK [horizon : Check horizon container] ************************************************************************************************************************************************************************************************
changed: [localhost]

TASK [horizon : include] ****************************************************************************************************************************************************************************************************************
skipping: [localhost]

TASK [horizon : include] ****************************************************************************************************************************************************************************************************************
skipping: [localhost]

RUNNING HANDLER [horizon : Restart horizon container] ***********************************************************************************************************************************************************************************
changed: [localhost]
...
...
TASK [skydive : include] ****************************************************************************************************************************************************************************************************************
skipping: [localhost]

PLAY RECAP ******************************************************************************************************************************************************************************************************************************
localhost                  : ok=224  changed=140  unreachable=0    failed=0


Here is the deploy. The instructions for kolla pike are very similar to ocata:

https://docs.openstack.org/kolla-ansible/pike/quickstart.html



root@osa:~# kolla-ansible deploy -i /tmp/kolla-ansible/ansible/inventory/all-in-one

PLAY RECAP ************************************************************************************************************************************************************************************************************************************************************
localhost                  : ok=187  changed=51   unreachable=0    failed=0

And here are the running containers after the deploy is finished:

root@osa:~# docker ps
CONTAINER ID        IMAGE                                                 COMMAND             CREATED              STATUS              PORTS               NAMES
407f0b50276c        kolla/centos-binary-horizon:5.0.1                     "kolla_start"       About a minute ago   Up About a minute                       horizon
d1a7732b9f94        kolla/centos-binary-heat-engine:5.0.1                 "kolla_start"       About a minute ago   Up About a minute                       heat_engine
8c1a7438b965        kolla/centos-binary-heat-api-cfn:5.0.1                "kolla_start"       About a minute ago   Up About a minute                       heat_api_cfn
eff2ec58a867        kolla/centos-binary-heat-api:5.0.1                    "kolla_start"       About a minute ago   Up About a minute                       heat_api
44fcfb23da69        kolla/centos-binary-neutron-metadata-agent:5.0.1      "kolla_start"       2 minutes ago        Up 2 minutes                            neutron_metadata_agent
d9d059a3892f        kolla/centos-binary-neutron-l3-agent:5.0.1            "kolla_start"       2 minutes ago        Up 2 minutes                            neutron_l3_agent
3e5324911abc        kolla/centos-binary-neutron-dhcp-agent:5.0.1          "kolla_start"       2 minutes ago        Up 2 minutes                            neutron_dhcp_agent
fb00e5e030de        kolla/centos-binary-neutron-openvswitch-agent:5.0.1   "kolla_start"       2 minutes ago        Up 2 minutes                            neutron_openvswitch_agent
23d3c895ad80        kolla/centos-binary-neutron-server:5.0.1              "kolla_start"       2 minutes ago        Up 2 minutes                            neutron_server
2087adc1b549        kolla/centos-binary-openvswitch-vswitchd:5.0.1        "kolla_start"       2 minutes ago        Up 2 minutes                            openvswitch_vswitchd
384f1d301c7a        kolla/centos-binary-openvswitch-db-server:5.0.1       "kolla_start"       2 minutes ago        Up 2 minutes                            openvswitch_db
ba7eaf9fb723        kolla/centos-binary-nova-compute:5.0.1                "kolla_start"       13 minutes ago       Up 13 minutes                           nova_compute
64dc377ea66b        kolla/centos-binary-nova-novncproxy:5.0.1             "kolla_start"       13 minutes ago       Up 13 minutes                           nova_novncproxy
04051e6e81f1        kolla/centos-binary-nova-consoleauth:5.0.1            "kolla_start"       13 minutes ago       Up 13 minutes                           nova_consoleauth
436284715e61        kolla/centos-binary-nova-conductor:5.0.1              "kolla_start"       13 minutes ago       Up 13 minutes                           nova_conductor
9ec5efca879c        kolla/centos-binary-nova-scheduler:5.0.1              "kolla_start"       13 minutes ago       Up 13 minutes                           nova_scheduler
3c65f2be8ef7        kolla/centos-binary-nova-api:5.0.1                    "kolla_start"       13 minutes ago       Up 13 minutes                           nova_api
651d8e83ca10        kolla/centos-binary-nova-placement-api:5.0.1          "kolla_start"       13 minutes ago       Up 13 minutes                           placement_api
7d275d989ee9        kolla/centos-binary-nova-libvirt:5.0.1                "kolla_start"       13 minutes ago       Up 13 minutes                           nova_libvirt
6404e330831f        kolla/centos-binary-nova-ssh:5.0.1                    "kolla_start"       13 minutes ago       Up 13 minutes                           nova_ssh
680016b569a0        kolla/centos-binary-glance-registry:5.0.1             "kolla_start"       14 minutes ago       Up 14 minutes                           glance_registry
f7ed0bebcc4c        kolla/centos-binary-glance-api:5.0.1                  "kolla_start"       14 minutes ago       Up 14 minutes                           glance_api
9af905247583        kolla/centos-binary-keystone:5.0.1                    "kolla_start"       15 minutes ago       Up 15 minutes                           keystone
f850f31ac7d3        kolla/centos-binary-rabbitmq:5.0.1                    "kolla_start"       15 minutes ago       Up 15 minutes                           rabbitmq
c8cdda6258b4        kolla/centos-binary-mariadb:5.0.1                     "kolla_start"       15 minutes ago       Up 15 minutes                           mariadb
c8e2e8dfebe7        kolla/centos-binary-memcached:5.0.1                   "kolla_start"       16 minutes ago       Up 16 minutes                           memcached
31d6d371a39a        kolla/centos-binary-keepalived:5.0.1                  "kolla_start"       16 minutes ago       Up 16 minutes                           keepalived
83384fc70d73        kolla/centos-binary-haproxy:5.0.1                     "kolla_start"       16 minutes ago       Up 16 minutes                           haproxy
a278b82cafd0        kolla/centos-binary-cron:5.0.1                        "kolla_start"       16 minutes ago       Up 16 minutes                           cron
2906c3737eaa        kolla/centos-binary-kolla-toolbox:5.0.1               "kolla_start"       16 minutes ago       Up 16 minutes                           kolla_toolbox
48b819ca400c        kolla/centos-binary-fluentd:5.0.1                     "kolla_start"       16 minutes ago       Up 16 minutes                           fluentd

Then I was able to re-create the rest of the config:

root@osa:~# kolla-ansible post-deploy
root@osa:~# pip install -U python-openstackclient
root@osa:~#cp /usr/local/share/kolla-ansible/init-runonce .
root@osa:~# vi init-runonce
root@osa:~# ./init-runonce
root@osa:~# openstack server create \
>     --image cirros \
>     --flavor m1.tiny \
>     --key-name mykey \
>     --nic net-id=df9a9e66-ad7e-4362-ad6f-998c541f6577 \
>     demo1
root@osa:~# openstack server list
+--------------------------------------+-------+--------+----------------------+--------+---------+
| ID                                   | Name  | Status | Networks             | Image  | Flavor  |
+--------------------------------------+-------+--------+----------------------+--------+---------+
| 7ce3b0a3-73b0-4c52-ab68-60118ae5b874 | demo1 | ACTIVE | demo-net=172.24.0.11 | cirros | m1.tiny |
+--------------------------------------+-------+--------+----------------------+--------+---------+
root@osa:~# openstack console log show demo1 | tail -40
/run/cirros/datasource/data/user-data was not '#!' or executable
=== system information ===
Platform: RDO OpenStack Compute
Container: none
Arch: x86_64
CPU(s): 1 @ 3407.936 MHz
Cores/Sockets/Threads: 1/1/1
Virt-type: AMD-V
RAM Size: 491MB
Disks:
NAME MAJ:MIN       SIZE LABEL         MOUNTPOINT
vda  253:0   1073741824
vda1 253:1   1061061120 cirros-rootfs /
=== sshd host keys ===
-----BEGIN SSH HOST KEY KEYS-----
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgwC3NvbQahyHLeoZRsUwQ3+kcxKw+L9i6vjT17Z2wZSgJgM9vbLzKiitXuIuV/kuEO9dyrUcdXDTHGX7qfigQ0lqS4uVz+lxL7qmv+mVgeoRSb872Lr7CIoxq/GgpWSc7kf2GzDZctgHlLIslmRVr8Szia8RUzK0UbvMfng+LXgI2Kw1 root@demo1
ssh-dss AAAAB3NzaC1kc3MAAACBAKezGJp3orZoAZa+rilDsQ0V/MYe4ZdGBYbVW0CQyXeBwtvvQCo65+HzuiKQJW+su6qqcdjRkt/C6hd68Y2cIcV3QqrcyiTay4xvyQqeC/DCFYML/mmI2keMd9kyldLrXX70RW0npVHZt/70DaLW3AlPzujJwjJz1U8+oTTaa3HbAAAAFQCwSj/zQJ66Kp+4A1l87Tidqw8GIwAAAIA0lfyGBo8uFAm8ATivYMuTMZr0uJCdgKcADwq3yEC3ThkSG8I2neLoprgb71mg+HeTetf1MUG9kAxE237bBvEKau/97LB/ur90AXXbYLZzptNf4UwG3MRqiDfiQjz2yw+xnt6wGnx9JZR7B5xABdTiPkJvGqG9am9C2/dwefhtbwAAAIEAkQ+woALAt01DHJqDYl36sFf1lNzDfB/WaKE/9i9/9Ng+fzjY1MYTdesyXzG5tZkyper3G9bETB75KxuYEX4yXa50rwFCMdgb3Rand3D8fQporeeJdAGlxQyFOwJ211xNOESFFz7BhvXn6Nt6V/QNpSstFjJc8tglcwM5XH1MP4I= root@demo1
-----END SSH HOST KEY KEYS-----
=== network info ===
if-info: lo,up,127.0.0.1,8,::1
if-info: eth0,up,172.24.0.11,24,fe80::f816:3eff:fe94:91c0
ip-route:default via 172.24.0.1 dev eth0
ip-route:169.254.169.254 via 172.24.0.2 dev eth0
ip-route:172.24.0.0/24 dev eth0  src 172.24.0.11
=== datasource: ec2 net ===
instance-id: i-00000001
name: N/A
availability-zone: nova
local-hostname: demo1.novalocal
launch-index: 0
=== cirros: current=0.3.5 latest=0.4.0 uptime=12.01 ===
  ____               ____  ____
 / __/ __ ____ ____ / __ \/ __/
/ /__ / // __// __// /_/ /\ \
\___//_//_/  /_/   \____/___/
   http://cirros-cloud.net


login as 'cirros' user. default password: 'cubswin:)'. use 'sudo' for root.

Later on I realized that the **pike** tag is used instead of **5.0.0** in dockerhub:

https://hub.docker.com/r/kolla/centos-binary-nova-api/tags/

So I updated the globals files:

root@osa:~# grep openstack_release /etc/kolla/globals.yml
#openstack_release: "5.0.1"
openstack_release: "pike"

And then the pull worked:

root@osa:~# kolla-ansible pull
Pulling Docker images : ansible-playbook -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one -e @/etc/kolla/globals.yml -e @/etc/kolla/passwords.yml -e CONFIG_DIR=/etc/kolla  -e action=pull /usr/local/share/kolla-ansible/ansible/site.yml
 [WARNING]: Found variable using reserved name: action


PLAY [Gather facts for all hosts] *******************************************************************************************************************************************************************************************************

TASK [setup] ****************************************************************************************************************************************************************************************************************************
ok: [localhost]
...
...
TASK [common : Pulling common images] ***************************************************************************************************************************************************************************************************
changed: [localhost] => (item={'key': u'cron', 'value': {u'environment': {u'DUMMY_ENVIRONMENT': u'kolla_useless_env'}, u'image': u'kolla/centos-binary-cron:pike', u'volumes': [u'/etc/kolla//cron/:/var/lib/kolla/config_files/:ro', u'/etc/localtime:/etc/localtime:ro', u'kolla_logs:/var/log/kolla/'], u'container_name': u'cron'}})
changed: [localhost] => (item={'key': u'fluentd', 'value': {u'environment': {u'KOLLA_CONFIG_STRATEGY': u'COPY_ALWAYS'}, u'image': u'kolla/centos-binary-fluentd:pike', u'volumes': [u'/etc/kolla//fluentd/:/var/lib/kolla/config_files/:ro', u'/etc/localtime:/etc/localtime:ro', u'kolla_logs:/var/log/kolla/'], u'container_name': u'fluentd'}})
changed: [localhost] => (item={'key': u'kolla-toolbox', 'value': {u'environment': {u'ANSIBLE_LIBRARY': u'/usr/share/ansible', u'ANSIBLE_NOCOLOR': u'1'}, u'image': u'kolla/centos-binary-kolla-toolbox:pike', u'privileged': True, u'volumes': [u'/etc/kolla//kolla-toolbox/:/var/lib/kolla/config_files/:ro', u'/etc/localtime:/etc/localtime:ro', u'/dev/:/dev/', u'/run/:/run/:shared', u'kolla_logs:/var/log/kolla/'], u'container_name': u'kolla_toolbox'}})

TASK [common : Registering common role has run] *****************************************************************************************************************************************************************************************
ok: [localhost]
...
...
TASK [skydive : include] ****************************************************************************************************************************************************************************************************************
skipping: [localhost]

PLAY RECAP ******************************************************************************************************************************************************************************************************************************
localhost                  : ok=28   changed=12   unreachable=0    failed=0

Then doing a re-deploy:

root@osa:~# kolla-ansible destroy -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one --yes-i-really-really-mean-it
root@osa:~# kolla-ansible deploy -i /usr/local/share/kolla-ansible/ansible/inventory/all-in-one

Worked out and I had the following versions running:

root@osa:~# docker ps
CONTAINER ID        IMAGE                                                COMMAND             CREATED              STATUS              PORTS               NAMES
e80c8c34c7b2        kolla/centos-binary-horizon:pike                     "kolla_start"       40 seconds ago       Up 39 seconds                           horizon
853fb098b689        kolla/centos-binary-heat-engine:pike                 "kolla_start"       47 seconds ago       Up 46 seconds                           heat_engine
668f74204b1d        kolla/centos-binary-heat-api-cfn:pike                "kolla_start"       48 seconds ago       Up 47 seconds                           heat_api_cfn
f2e0eda99aaa        kolla/centos-binary-heat-api:pike                    "kolla_start"       49 seconds ago       Up 48 seconds                           heat_api
b8330cfcab88        kolla/centos-binary-neutron-metadata-agent:pike      "kolla_start"       About a minute ago   Up About a minute                       neutron_metadata_agent
b303160017d1        kolla/centos-binary-neutron-l3-agent:pike            "kolla_start"       About a minute ago   Up About a minute                       neutron_l3_agent
8aafaa7e1df7        kolla/centos-binary-neutron-dhcp-agent:pike          "kolla_start"       About a minute ago   Up About a minute                       neutron_dhcp_agent
18dda178d1d8        kolla/centos-binary-neutron-openvswitch-agent:pike   "kolla_start"       About a minute ago   Up About a minute                       neutron_openvswitch_agent
2663ea7fbc52        kolla/centos-binary-neutron-server:pike              "kolla_start"       About a minute ago   Up About a minute                       neutron_server
3dfdbf997c18        kolla/centos-binary-openvswitch-vswitchd:pike        "kolla_start"       2 minutes ago        Up About a minute                       openvswitch_vswitchd
80e7262c9e3d        kolla/centos-binary-openvswitch-db-server:pike       "kolla_start"       2 minutes ago        Up 2 minutes                            openvswitch_db
d1c24b538372        kolla/centos-binary-nova-compute:pike                "kolla_start"       2 minutes ago        Up 2 minutes                            nova_compute
ae12ff8d5a0d        kolla/centos-binary-nova-novncproxy:pike             "kolla_start"       2 minutes ago        Up 2 minutes                            nova_novncproxy
0051f11a399f        kolla/centos-binary-nova-consoleauth:pike            "kolla_start"       2 minutes ago        Up 2 minutes                            nova_consoleauth
f834fbfe0aea        kolla/centos-binary-nova-conductor:pike              "kolla_start"       2 minutes ago        Up 2 minutes                            nova_conductor
93b4e465d08c        kolla/centos-binary-nova-scheduler:pike              "kolla_start"       2 minutes ago        Up 2 minutes                            nova_scheduler
685a019fe51d        kolla/centos-binary-nova-api:pike                    "kolla_start"       2 minutes ago        Up 2 minutes                            nova_api
43a90fa504e8        kolla/centos-binary-nova-placement-api:pike          "kolla_start"       2 minutes ago        Up 2 minutes                            placement_api
667cf68fb857        kolla/centos-binary-nova-libvirt:pike                "kolla_start"       2 minutes ago        Up 2 minutes                            nova_libvirt
dc32facdac9e        kolla/centos-binary-nova-ssh:pike                    "kolla_start"       2 minutes ago        Up 2 minutes                            nova_ssh
67fbba06ca23        kolla/centos-binary-glance-registry:pike             "kolla_start"       3 minutes ago        Up 3 minutes                            glance_registry
b691c85041c9        kolla/centos-binary-glance-api:pike                  "kolla_start"       3 minutes ago        Up 3 minutes                            glance_api
e900317f4b71        kolla/centos-binary-keystone:pike                    "kolla_start"       4 minutes ago        Up 4 minutes                            keystone
9d6d82590621        kolla/centos-binary-rabbitmq:pike                    "kolla_start"       4 minutes ago        Up 4 minutes                            rabbitmq
1ed59fba8e11        kolla/centos-binary-mariadb:pike                     "kolla_start"       4 minutes ago        Up 4 minutes                            mariadb
74b6e6ae0557        kolla/centos-binary-memcached:pike                   "kolla_start"       5 minutes ago        Up 5 minutes                            memcached
6276b52a4c7f        kolla/centos-binary-keepalived:pike                  "kolla_start"       5 minutes ago        Up 5 minutes                            keepalived
099c74158151        kolla/centos-binary-haproxy:pike                     "kolla_start"       5 minutes ago        Up 5 minutes                            haproxy
ece2011696f3        kolla/centos-binary-cron:pike                        "kolla_start"       5 minutes ago        Up 5 minutes                            cron
4cb41bdd9ff1        kolla/centos-binary-kolla-toolbox:pike               "kolla_start"       5 minutes ago        Up 5 minutes                            kolla_toolbox
5c6e20f6c6f2        kolla/centos-binary-fluentd:pike                     "kolla_start"       5 minutes ago        Up 5 minutes                            fluentd
